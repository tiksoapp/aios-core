<!-- 翻译: ZH-CN | 原文: /docs/en/architecture/high-level-architecture.md | 同步时间: 2026-01-26 -->

# AIOS v4 高级架构

> 🌐 [EN](../../architecture/high-level-architecture.md) | [PT](../../pt/architecture/high-level-architecture.md) | [ES](../../es/architecture/high-level-architecture.md) | **ZH-CN**

---

**版本:** 2.1.0
**上次更新:** 2025-12-09
**状态:** 官方架构文档

---

## 目录

- [概览](#概览)
- [架构图](#架构图)
- [模块化架构](#模块化架构)
- [多仓库策略](#多仓库策略)
- [技术栈](#技术栈)
- [目录结构](#目录结构)
- [主要组件](#主要组件)
- [质量门槛](#质量门槛)

---

## 概览

**AIOS（AI 操作系统）** 是用于 AI 代理、工作者和人类在复杂软件开发工作流中进行编排的精巧框架。v2.1 版本引入了具有 4 个模块的模块化架构、多仓库策略和 3 层质量门槛。

### v4.2 主要功能

| 功能 | 描述 |
| ---- | ---- |
| **11 个专业代理** | 开发、QA、架构师、PM、PO、SM、分析师、数据工程师、DevOps、UX、主代理 |
| **115+ 可执行任务** | 创建故事、代码生成、测试、部署、文档 |
| **52+ 模板** | PRD、故事、架构文档、IDE 规则、质量门槛 |
| **4 模块架构** | 核心、开发、产品、基础设施 |
| **3 层质量门槛** | 提交前、PR 自动化、人工审查 |
| **多仓库策略** | 3 个公开仓库 + 2 个私有仓库 |
| **Squad 系统** | AI 代理的模块化团队 (ETL, Creator, MMOS) |

---

## 架构图

### 4 模块架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     AIOS v4 框架                                       │
│                     ═══════════════                                     │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                        CLI / 工具                              │   │
│   │  (aios agents, aios tasks, aios squads, aios workflow)          │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                │                                        │
│          ┌────────────────────┼────────────────────┐                   │
│          │                    │                    │                   │
│          ▼                    ▼                    ▼                   │
│   ┌──────────────┐   ┌──────────────┐   ┌─────────────────┐           │
│   │  开发模块    │   │  产品模块    │   │  基础设施模块   │           │
│   │  ────────   │   │  ────────   │   │  ──────────   │           │
│   │ • 11 个代理 │   │ • 52+ 模板  │   │ • 55+ 脚本     │           │
│   │ • 115+ 任务 │   │ • 11 检查表 │   │ • 配置工具     │           │
│   │ • 7 个工作流 │   │ • PM 数据   │   │ • 集成         │           │
│   │ • 开发脚本  │   │             │   │ • PM 适配器    │           │
│   └──────┬───────┘   └──────┬───────┘   └────────┬────────┘           │
│          │                  │                    │                     │
│          └──────────────────┼────────────────────┘                     │
│                             │                                          │
│                             ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                      核心模块                                  │   │
│   │                      ═══════                                  │   │
│   │                                                                  │   │
│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │   │
│   │   │   配置      │  │   注册表    │  │    质量门槛             │ │   │
│   │   │   系统      │  │   (服务     │  │    (3 层)               │ │   │
│   │   │             │  │   发现)     │  │                         │ │   │
│   │   └─────────────┘  └─────────────┘  └─────────────────────────┘ │   │
│   │                                                                  │   │
│   │   ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │   │
│   │   │    MCP      │  │   会话      │  │     询问                │ │   │
│   │   │   系统      │  │   管理器    │  │     引擎                │ │   │
│   │   │             │  │             │  │                         │ │   │
│   │   └─────────────┘  └─────────────┘  └─────────────────────────┘ │   │
│   │                                                                  │   │
│   │   无内部依赖项（基础层）                                         │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 模块间关系

```
┌────────────────────────────────────────────────────────────────────────┐
│                    模块依赖流                                          │
│                                                                         │
│                         ┌──────────────┐                                │
│                         │  CLI/工具    │                                │
│                         └──────┬───────┘                                │
│                                │                                        │
│              ┌─────────────────┼─────────────────┐                      │
│              │                 │                 │                      │
│              ▼                 ▼                 ▼                      │
│     ┌────────────────┐ ┌────────────────┐ ┌────────────────┐           │
│     │  development/  │ │    product/    │ │infrastructure/ │           │
│     │                │ │                │ │                │           │
│     │  • 代理        │ │  • 模板        │ │  • 脚本        │           │
│     │  • 任务        │ │  • 检查表      │ │  • 工具        │           │
│     │  • 工作流      │ │  • PM 数据     │ │  • 集成        │           │
│     └───────┬────────┘ └───────┬────────┘ └───────┬────────┘           │
│             │                  │                  │                     │
│             │         仅依赖于                   │                     │
│             └──────────────────┼──────────────────┘                     │
│                                │                                        │
│                                ▼                                        │
│                      ┌────────────────┐                                 │
│                      │     core/      │                                 │
│                      │                │                                 │
│                      │   无依赖项     │                                 │
│                      └────────────────┘                                 │
│                                                                         │
│   规则:                                                                │
│   • core/ 没有内部依赖项                                               │
│   • development/, product/, infrastructure/ 仅依赖于 core/            │
│   • 禁止循环依赖                                                      │
│   • CLI/工具可以访问任何模块                                          │
│                                                                         │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 多仓库策略

### 仓库结构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    SYNKRA 组织                                          │
│                                                                         │
│   公开仓库                                                             │
│   ═════════                                                           │
│                                                                         │
│   ┌────────────────────┐     ┌────────────────────┐                    │
│   │  SynkraAI/         │     │  SynkraAI/         │                    │
│   │  aios-core         │     │  aios-squads       │                    │
│   │  (MIT)  │◄────│  (MIT)             │                    │
│   │                    │     │                    │                    │
│   │  • 核心框架        │     │  • ETL Squad       │                    │
│   │  • 11 个基础代理   │     │  • Creator Squad   │                    │
│   │  • 质量门槛        │     │  • MMOS Squad      │                    │
│   │  • 讨论中心        │     │                    │                    │
│   └────────────────────┘     └────────────────────┘                    │
│            │                                                            │
│            │ 可选依赖                                                   │
│            ▼                                                            │
│   ┌────────────────────┐                                               │
│   │  SynkraAI/         │                                               │
│   │  mcp-ecosystem     │                                               │
│   │  (Apache 2.0)      │                                               │
│   │                    │                                               │
│   │  • Docker MCP      │                                               │
│   │  • IDE 配置        │                                               │
│   │  • MCP 预设        │                                               │
│   └────────────────────┘                                               │
│                                                                         │
│   私有仓库                                                             │
│   ═════════════                                                       │
│                                                                         │
│   ┌────────────────────┐     ┌────────────────────┐                    │
│   │  SynkraAI/mmos     │     │  SynkraAI/         │                    │
│   │  (专有+NDA)        │     │  certified-partners│                    │
│   │                    │     │  (专有)            │                    │
│   │  • MMOS Minds      │     │  • 高级 Squads     │                    │
│   │  • DNA Mental™     │     │  • 合作伙伴门户    │                    │
│   └────────────────────┘     └────────────────────┘                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### npm 包范围

| 包 | 注册表 | 许可证 |
| --- | --- | --- |
| `@aios/core` | npm 公开 | MIT |
| `@aios/squad-etl` | npm 公开 | MIT |
| `@aios/squad-creator` | npm 公开 | MIT |
| `@aios/squad-mmos` | npm 公开 | MIT |
| `@aios/mcp-presets` | npm 公开 | Apache 2.0 |

---

## 技术栈

| 类别 | 技术 | 版本 | 注释 |
| --- | --- | --- | --- |
| 运行时 | Node.js | ≥18.0.0 | 所有脚本的平台 |
| 语言 | TypeScript/JavaScript | ES2022 | 主要开发 |
| 定义 | Markdown + YAML | N/A | 代理、任务、模板 |
| 包管理器 | npm | ≥9.0.0 | 依赖项管理 |
| 质量门槛 | Husky + lint-staged | 最新版 | 提交前钩子 |
| 代码审查 | CodeRabbit | 最新版 | AI 审查 |
| CI/CD | GitHub Actions | N/A | 自动化工作流 |

---

## 目录结构

### 当前结构 (v4)

```
@synkra/aios-core/
├── .aios-core/                    # 框架层
│   ├── core/                      # 核心模块（基础）
│   │   ├── config/                # 配置管理
│   │   ├── registry/              # 服务发现
│   │   ├── quality-gates/         # 3 层 QG 系统
│   │   ├── mcp/                   # 全局 MCP 配置
│   │   └── session/               # 会话管理
│   │
│   ├── development/               # 开发模块
│   │   ├── agents/                # 11 个代理定义
│   │   ├── tasks/                 # 115+ 任务定义
│   │   ├── workflows/             # 7 个工作流定义
│   │   └── scripts/               # 开发脚本
│   │
│   ├── product/                   # 产品模块
│   │   ├── templates/             # 52+ 模板
│   │   ├── checklists/            # 11 个检查表
│   │   └── data/                  # PM 知识库
│   │
│   ├── infrastructure/            # 基础设施模块
│   │   ├── scripts/               # 55+ 基础设施脚本
│   │   ├── tools/                 # CLI、MCP、本地配置
│   │   └── integrations/          # PM 适配器
│   │
│   └── docs/                      # 框架文档
│       └── standards/             # 标准文档
│
├── docs/                          # 项目文档
│   ├── stories/                   # 开发故事
│   ├── architecture/              # 架构文档
│   └── epics/                     # 史诗规划
│
├── squads/                        # Squad 实现
│   ├── etl/                       # ETL Squad
│   ├── creator/                   # Creator Squad
│   └── mmos-mapper/               # MMOS Squad
│
├── .github/                       # GitHub 自动化
│   ├── workflows/                 # CI/CD 工作流
│   ├── ISSUE_TEMPLATE/            # 问题模板
│   └── CODEOWNERS                 # 代码所有权
│
└── .husky/                        # Git 钩子 (QG 第 1 层)
```

---

## 主要组件

### 模块概览

| 模块 | 路径 | 目的 | 主要内容 |
| --- | --- | --- | --- |
| **核心** | `.aios-core/core/` | 框架基础 | 配置、注册表、QG、MCP、会话 |
| **开发** | `.aios-core/development/` | 开发制品 | 代理、任务、工作流、脚本 |
| **产品** | `.aios-core/product/` | PM 制品 | 模板、检查表、数据 |
| **基础设施** | `.aios-core/infrastructure/` | 系统配置 | 脚本、工具、集成 |

### 代理系统

| 代理 | ID | 原型 | 责任 |
| --- | --- | --- | --- |
| Dex | `dev` | 构建者 | 代码实现 |
| Quinn | `qa` | 守护者 | 质量保证 |
| Aria | `architect` | 架构师 | 技术架构 |
| Nova | `po` | 远见者 | 产品待办 |
| Kai | `pm` | 平衡者 | 产品策略 |
| River | `sm` | 协调者 | 过程协调 |
| Zara | `analyst` | 探索者 | 业务分析 |
| Dara | `data-engineer` | 架构师 | 数据工程 |
| Felix | `devops` | 优化者 | CI/CD 和操作 |
| Uma | `ux-expert` | 创造者 | 用户体验 |
| Pax | `aios-master` | 编排者 | 框架编排 |

---

## 质量门槛

### 3 层质量门槛系统

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     3 层质量门槛                                         │
│                                                                         │
│   ┌───────────────────────────────────────────────────────────────────┐ │
│   │ 第 1 层: 提交前（本地）                                            │ │
│   │ ═════════════════════                                            │ │
│   │ • ESLint、Prettier、TypeScript                                    │ │
│   │ • 单元测试（快速）                                                │ │
│   │ • 工具: Husky + lint-staged                                       │ │
│   │ • 强制: 失败无法提交                                              │ │
│   │ • 捕获问题: 30%                                                   │ │
│   └───────────────────────────────────────────────────────────────────┘ │
│                                │                                        │
│                                ▼                                        │
│   ┌───────────────────────────────────────────────────────────────────┐ │
│   │ 第 2 层: PR 自动化（CI/CD）                                       │ │
│   │ ═══════════════════════════                                      │ │
│   │ • AI CodeRabbit 审查                                              │ │
│   │ • 集成测试、覆盖率分析                                            │ │
│   │ • 安全扫描、性能基准                                              │ │
│   │ • 工具: GitHub Actions + CodeRabbit                               │ │
│   │ • 强制: 检查必须通过才能合并                                      │ │
│   │ • 捕获问题: +50% 额外（总计 80%）                                 │ │
│   └───────────────────────────────────────────────────────────────────┘ │
│                                │                                        │
│                                ▼                                        │
│   ┌───────────────────────────────────────────────────────────────────┐ │
│   │ 第 3 层: 人工审查（战略）                                         │ │
│   │ ═════════════════════════                                        │ │
│   │ • 架构对齐                                                        │ │
│   │ • 业务逻辑正确性                                                  │ │
│   │ • 边界情况、文档质量                                              │ │
│   │ • 工具: 人工专业知识                                              │ │
│   │ • 强制: 需要最终批准                                              │ │
│   │ • 捕获问题: 最后 20%（总计 100%）                                 │ │
│   └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│   结果: 80% 的问题自动捕获                                            │
│        人工审查时间: 30 分钟/PR（vs v2.0 中的 2-4 小时）              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 相关文档

- [模块系统](./module-system.md) - 模块详细架构
- [ARCHITECTURE-INDEX.md](./ARCHITECTURE-INDEX.md) - 完整文档索引
- [AIOS-LIVRO-DE-OURO-V2.1-COMPLETE.md](../../../.aios-core/docs/standards/AIOS-LIVRO-DE-OURO-V2.1-COMPLETE.md) - 框架完整指南

---

**上次更新:** 2025-12-09
**版本:** 2.1.0
**维护者:** @architect (Aria)
