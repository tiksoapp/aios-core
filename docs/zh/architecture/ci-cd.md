<!-- ç¿»è¯‘: ZH-CN | åŸæ–‡: /docs/en/architecture/ci-cd.md | åŒæ­¥: 2026-02-22 -->

# CI/CD æ¶æ„

> ğŸŒ [EN](../../architecture/ci-cd.md) | [PT](../../pt/architecture/ci-cd.md) | **ZH** | [ES](../../es/architecture/ci-cd.md)

---

> æ•…äº‹ 6.1: GitHub Actions æˆæœ¬ä¼˜åŒ–

## æ¦‚è¿°

AIOS-Core ä½¿ç”¨ GitHub Actions è¿›è¡ŒæŒç»­é›†æˆå’Œéƒ¨ç½²ã€‚æœ¬æ–‡æ¡£æè¿°äº†æ•…äº‹ 6.1 ä¸­å®ç°çš„ä¼˜åŒ–å·¥ä½œæµæ¶æ„ã€‚

## å·¥ä½œæµå±‚çº§

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è§¦å‘äº‹ä»¶                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‹‰å–è¯·æ±‚ â†’ ci.yml (å¿…éœ€) + pr-automation.yml (æŒ‡æ ‡)              â”‚
â”‚  æ¨é€åˆ° main â†’ ci.yml + semantic-release.yml + test.yml         â”‚
â”‚              + cross-platform (ci.yml ä¸­çš„æ¡ä»¶)                 â”‚
â”‚  æ ‡ç­¾ v*   â†’ release.yml â†’ npm-publish.yml                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜:** PR ä»…æ‰§è¡Œ ci.yml å’Œ pr-automation.yml (~12 ä¸ªä½œä¸š)ã€‚æ‰©å±•æµ‹è¯• (test.yml) ä»…åœ¨æ¨é€åˆ° main æ—¶æ‰§è¡Œã€‚

## æ´»è·ƒå·¥ä½œæµ

| å·¥ä½œæµ                | ç›®çš„                                  | è§¦å‘           | å…³é”® |
| --------------------- | ------------------------------------- | -------------- | ---- |
| `ci.yml`              | ä¸»è¦ CI éªŒè¯ (lintã€typecheckã€test) | PRã€push main  | æ˜¯   |
| `pr-automation.yml`   | è¦†ç›–ç‡æŠ¥å‘Šå’ŒæŒ‡æ ‡                      | ä»… PR          | å¦   |
| `semantic-release.yml` | è‡ªåŠ¨ç‰ˆæœ¬åŒ–å’Œ changelog                | æ¨é€åˆ° main    | æ˜¯   |
| `test.yml`            | æ‰©å±•æµ‹è¯• (å®‰å…¨ã€æ„å»ºã€é›†æˆ)          | ä»… push main   | å¦   |
| `macos-testing.yml`   | macOS ç‰¹å®šæµ‹è¯• (Intel + ARM)         | æŒ‰ path è¿‡æ»¤   | å¦   |
| `release.yml`         | GitHub å‘å¸ƒåˆ›å»º                       | æ ‡ç­¾ v\*       | æ˜¯   |
| `npm-publish.yml`     | å‘å¸ƒåˆ° NPM                            | å‘å¸ƒå·²å‘å¸ƒ     | æ˜¯   |
| `pr-labeling.yml`     | è‡ªåŠ¨ PR æ ‡ç­¾                          | PR æ‰“å¼€/åŒæ­¥   | å¦   |
| `quarterly-gap-audit.yml` | è®¡åˆ’å®¡è®¡                           | Cron           | å¦   |
| `welcome.yml`         | æ¬¢è¿æ–°æ‰‹è´¡çŒ®è€…                        | PR             | å¦   |

## ä¼˜åŒ–ç­–ç•¥

### 1. å¹¶å‘æ§åˆ¶

æ‰€æœ‰å·¥ä½œæµä½¿ç”¨å¹¶å‘ç»„æ¥é¿å…é‡å¤æ‰§è¡Œ:

```yaml
concurrency:
  group: <workflow>-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true  # ç”¨äº CI å·¥ä½œæµ
  # æˆ–
  cancel-in-progress: false  # ç”¨äºå‘å¸ƒ/å‘å¸ƒå·¥ä½œæµ
```

### 2. è·¯å¾„è¿‡æ»¤

å·¥ä½œæµå¿½ç•¥ä»…æ–‡æ¡£æ›´æ”¹çš„ä¸å¿…è¦æ‰§è¡Œ:

```yaml
paths-ignore:
  - 'docs/**'
  - '*.md'
  - '.aios/**'
  - 'squads/**'
  - 'LICENSE'
  - '.gitignore'
```

### 3. æ¡ä»¶è·¨å¹³å°æµ‹è¯•

è·¨å¹³å°çŸ©é˜µ (3 ä¸ªæ“ä½œç³»ç»Ÿ x 3 ä¸ª Node ç‰ˆæœ¬ = æ’é™¤å 7 ä¸ªä½œä¸š) ä»…åœ¨æ¨é€åˆ° main æ—¶æ‰§è¡Œ:

```yaml
cross-platform:
  if: github.ref == 'refs/heads/main' && github.event_name == 'push'
  strategy:
    matrix:
      os: [ubuntu-latest, windows-latest, macos-latest]
      node: ['18', '20', '22']
      exclude:
        - os: macos-latest
          node: '18' # isolated-vm çš„ SIGSEGV
        - os: macos-latest
          node: '20' # isolated-vm çš„ SIGSEGV
```

### 4. ç»Ÿä¸€éªŒè¯

å•ä¸€çš„çœŸå®æ¥æºç”¨äºéªŒè¯:

- **ci.yml** å¤„ç†æ‰€æœ‰éªŒè¯ (lintã€typecheckã€test)
- **semantic-release.yml** ä¾èµ–åˆ†æ”¯ä¿æŠ¤ (ä¸éœ€è¦é‡å¤çš„ CI)
- **pr-automation.yml** ä»…å…³æ³¨æŒ‡æ ‡/è¦†ç›–ç‡

## å¯è®¡è´¹åˆ†é’Ÿå‡å°‘

| å‰        | å         | èŠ‚çœ |
| --------- | ---------- | ---- |
| ~340 åˆ†é’Ÿ/å‘¨ | ~85 åˆ†é’Ÿ/å‘¨ | ~75% |

### è¯¦ç»†è¯´æ˜:

- å¹¶å‘: 40% å‡å°‘ (å–æ¶ˆè¿‡æ—¶çš„æ‰§è¡Œ)
- è·¯å¾„è¿‡æ»¤: 30% å‡å°‘ (å¿½ç•¥ä»…æ–‡æ¡£ PR)
- ç»Ÿä¸€è·¨å¹³å°: 25% å‡å°‘ (7 å¯¹ 16 ä¸ªä½œä¸š)
- ç§»é™¤å†—ä½™å·¥ä½œæµ: 5% å‡å°‘

## åˆ†æ”¯ç­–ç•¥

æ‰€æœ‰å·¥ä½œæµä»…é¢å‘ `main` åˆ†æ”¯:

- æ—  `master` æˆ– `develop` åˆ†æ”¯
- åŠŸèƒ½åˆ†æ”¯ â†’ æ‹‰å–è¯·æ±‚åˆ° main
- é€šè¿‡ main ä¸Šçš„ semantic-release å‘å¸ƒ

## å¼ºåˆ¶çŠ¶æ€æ£€æŸ¥

ç”¨äº `main` ä¸Šçš„åˆ†æ”¯ä¿æŠ¤:

1. `CI / ESLint`
2. `CI / TypeScript Type Checking`
3. `CI / Jest Tests`
4. `CI / Validation Summary`

## æ•…éšœæ’é™¤

### å·¥ä½œæµä¸æ‰§è¡Œ?

1. æ£€æŸ¥è·¯å¾„æ˜¯å¦åœ¨ `paths-ignore` ä¸­
2. æ£€æŸ¥åˆ†æ”¯æ˜¯å¦ä¸è§¦å‘æ¡ä»¶åŒ¹é…
3. æ£€æŸ¥å¹¶å‘ç»„ (å¯èƒ½å·²è¢«å–æ¶ˆ)

### å‘å¸ƒæœªå‘å¸ƒ?

1. æ£€æŸ¥ `NPM_TOKEN` secret æ˜¯å¦é…ç½®
2. æ£€æŸ¥ semantic-release é…ç½®
3. æ£€æŸ¥å¸¸è§„ commit æ ¼å¼

### macOS æµ‹è¯•å¤±è´¥?

- Node 18/20 åœ¨ macOS ä¸Šå­˜åœ¨ isolated-vm çš„ SIGSEGV é—®é¢˜
- ä»… Node 22 åœ¨ macOS ä¸Šæ‰§è¡Œ (æŒ‰è®¾è®¡)

## ç›¸å…³æ–‡æ¡£

- [GitHub Actions è®¡è´¹](https://docs.github.com/en/billing/managing-billing-for-github-actions)
- [Semantic Release](https://semantic-release.gitbook.io/)
