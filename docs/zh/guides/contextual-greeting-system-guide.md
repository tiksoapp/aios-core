# ä¸Šä¸‹æ–‡é—®å€™ç³»ç»ŸæŒ‡å—

> [EN](../../guides/contextual-greeting-system-guide.md) | [PT](../../pt/guides/contextual-greeting-system-guide.md) | [ES](../../es/guides/contextual-greeting-system-guide.md) | **ZH**

---

**æ•…äº‹:** 6.1.2.5 - ä¸Šä¸‹æ–‡ä»£ç†åŠ è½½ç³»ç»Ÿ
**çŠ¶æ€:** ç»„ä»¶å·²å®ç°ï¼Œé›†æˆå¾…å®Œæˆ
**æ—¥æœŸ:** 2025-01-15

---

## æ¦‚è¿°

ä¸Šä¸‹æ–‡é—®å€™ç³»ç»Ÿæ˜¯ä¸€é¡¹ UX æ”¹è¿›ï¼Œä½¿ AIOS ä»£ç†çš„é—®å€™å˜å¾—æ™ºèƒ½å’Œè‡ªé€‚åº”ï¼Œæ ¹æ®ä¼šè¯ä¸Šä¸‹æ–‡æ˜¾ç¤ºç›¸å…³ä¿¡æ¯å’Œå‘½ä»¤ã€‚

## å·²å®ç°çš„å†…å®¹

### æ ¸å¿ƒç»„ä»¶ (Story 6.1.2.5)

1. **ContextDetector** (`.aios-core/core/session/context-detector.js`)
   - æ£€æµ‹ä¼šè¯ç±»å‹: `new`ã€`existing` æˆ– `workflow`
   - æ··åˆæ–¹æ³•: å¯¹è¯å†å² (é¦–é€‰) + ä¼šè¯æ–‡ä»¶ (åå¤‡)
   - éæ´»åŠ¨ä¼šè¯ TTL 1 å°æ—¶

2. **GitConfigDetector** (`.aios-core/infrastructure/scripts/git-config-detector.js`)
   - æ£€æµ‹é¡¹ç›®çš„ git é…ç½®
   - TTL 5 åˆ†é’Ÿçš„ç¼“å­˜
   - 1000ms è¶…æ—¶ä¿æŠ¤

3. **GreetingBuilder** (`.aios-core/development/scripts/greeting-builder.js`)
   - æ ¹æ®ä¼šè¯ç±»å‹æ„å»ºä¸Šä¸‹æ–‡é—®å€™
   - æŒ‰å¯è§æ€§è¿‡æ»¤å‘½ä»¤ (full/quick/key)
   - 150ms è¶…æ—¶å¹¶ä¼˜é›…å›é€€

4. **WorkflowNavigator** (`.aios-core/development/scripts/workflow-navigator.js`)
   - æ£€æµ‹å½“å‰å·¥ä½œæµçŠ¶æ€
   - æ ¹æ®çŠ¶æ€å»ºè®®ä¸‹ä¸€ä¸ªå‘½ä»¤
   - é¢„å¡«å……å¸¦ä¸Šä¸‹æ–‡çš„å‘½ä»¤ (story path, branch)

5. **å·¥ä½œæµæ¨¡å¼** (`.aios-core/data/workflow-patterns.yaml`)
   - å®šä¹‰äº† 10 ä¸ªå¸¸è§å·¥ä½œæµ
   - å¸¦ä¸‹ä¸€æ­¥å»ºè®®çš„çŠ¶æ€è½¬æ¢
   - æ ¹æ®å®é™…é¡¹ç›®ä½¿ç”¨éªŒè¯çš„æ¨¡å¼

### å¾…å®Œæˆ (æœªæ¥æ•…äº‹ - 6.1.4 æˆ– 6.1.6)

**ä¸æ¿€æ´»æµç¨‹çš„é›†æˆ:**
- æ‹¦æˆªä»£ç†æ¿€æ´» (å½“æ‚¨è¾“å…¥ `@dev`ã€`@po` ç­‰æ—¶)
- è‡ªåŠ¨è°ƒç”¨ GreetingBuilder
- åœ¨é»˜è®¤é—®å€™ä½ç½®æ³¨å…¥ä¸Šä¸‹æ–‡é—®å€™

## ä¼šè¯ç±»å‹

### 1. æ–°ä¼šè¯

**ä½•æ—¶:** é¦–æ¬¡äº¤äº’æˆ– 1 å°æ—¶ä¸æ´»åŠ¨å

**ç‰¹ç‚¹:**
- å®Œæ•´ä»‹ç» (archetypal é—®å€™)
- ä»£ç†è§’è‰²æè¿°
- é¡¹ç›®çŠ¶æ€ (å¦‚æœé…ç½®äº† git)
- å®Œæ•´å‘½ä»¤ (visibility=full çš„æœ€å¤š 12 ä¸ªå‘½ä»¤)

**ç¤ºä¾‹:**
```
ğŸ’» Dex (Builder) å‡†å¤‡å°±ç»ªã€‚è®©æˆ‘ä»¬æ„å»ºä¸€äº›å¾ˆæ£’çš„ä¸œè¥¿!

**è§’è‰²:** ä¸“æ³¨äºå¹²å‡€ã€å¯ç»´æŠ¤ä»£ç çš„å…¨æ ˆå¼€å‘è€…

ğŸ“Š é¡¹ç›®çŠ¶æ€:
ğŸŒ¿ main
ğŸ“ 5 ä¸ªä¿®æ”¹çš„æ–‡ä»¶
ğŸ“¦ æœ€åæäº¤: feat: implement greeting system

**å¯ç”¨å‘½ä»¤:**
   - `*help`: æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
   - `*develop`: å®ç°æ•…äº‹ä»»åŠ¡
   - `*review-code`: å®¡æŸ¥ä»£ç æ›´æ”¹
   - `*run-tests`: æ‰§è¡Œæµ‹è¯•å¥—ä»¶
   - `*build`: ä¸ºç”Ÿäº§æ„å»º
   ... (æœ€å¤š 12 ä¸ªå‘½ä»¤)
```

### 2. ç°æœ‰ä¼šè¯

**ä½•æ—¶:** åœ¨åŒä¸€ä¼šè¯ä¸­ç»§ç»­å·¥ä½œ

**ç‰¹ç‚¹:**
- ç®€çŸ­ä»‹ç» (named é—®å€™)
- é¡¹ç›®çŠ¶æ€
- å½“å‰ä¸Šä¸‹æ–‡ (ä¸Šæ¬¡æ“ä½œ)
- å¿«é€Ÿå‘½ä»¤ (visibility=quick çš„ 6-8 ä¸ªå‘½ä»¤)

**ç¤ºä¾‹:**
```
ğŸ’» Dex (Builder) å‡†å¤‡å°±ç»ªã€‚

ğŸ“Š é¡¹ç›®çŠ¶æ€:
ğŸŒ¿ feature/story-6.1.2.5
ğŸ“ 3 ä¸ªä¿®æ”¹çš„æ–‡ä»¶

ğŸ“Œ **ä¸Šæ¬¡æ“ä½œ:** review-code

**å¿«é€Ÿå‘½ä»¤:**
   - `*help`: æ˜¾ç¤ºå¸®åŠ©
   - `*develop`: å®ç°æ•…äº‹
   - `*review-code`: å®¡æŸ¥ä»£ç 
   - `*run-tests`: è¿è¡Œæµ‹è¯•
   - `*qa-gate`: è¿è¡Œè´¨é‡é—¨ç¦
   ... (6-8 ä¸ªæœ€å¸¸ç”¨çš„å‘½ä»¤)
```

### 3. å·¥ä½œæµä¼šè¯

**ä½•æ—¶:** åœ¨æ´»åŠ¨å·¥ä½œæµä¸­ (ä¾‹å¦‚: éªŒè¯æ•…äº‹å)

**ç‰¹ç‚¹:**
- æœ€å°ä»‹ç» (minimal é—®å€™)
- å‹ç¼©çš„é¡¹ç›®çŠ¶æ€
- å·¥ä½œæµä¸Šä¸‹æ–‡ (æ­£åœ¨å¤„ç† X)
- **ä¸‹ä¸€æ­¥å»ºè®®** (æ–°åŠŸèƒ½!)
- å…³é”®å‘½ä»¤ (visibility=key çš„ 3-5 ä¸ªå‘½ä»¤)

**ç¤ºä¾‹:**
```
âš–ï¸ Pax å‡†å¤‡å°±ç»ªã€‚

ğŸ“Š ğŸŒ¿ main | ğŸ“ 5 ä¸ªä¿®æ”¹ | ğŸ“– STORY-6.1.2.5

ğŸ“Œ **ä¸Šä¸‹æ–‡:** æ­£åœ¨å¤„ç† Story 6.1.2.5

**æ•…äº‹å·²éªŒè¯! ä¸‹ä¸€æ­¥:**

1. `*develop-yolo story-6.1.2.5.md` - è‡ªä¸»æ¨¡å¼ (æ— ä¸­æ–­)
2. `*develop-interactive story-6.1.2.5.md` - äº¤äº’æ¨¡å¼å¸¦æ£€æŸ¥ç‚¹
3. `*develop-preflight story-6.1.2.5.md` - å…ˆè®¡åˆ’ï¼Œåæ‰§è¡Œ

**å…³é”®å‘½ä»¤:**
   - `*help`: æ˜¾ç¤ºå¸®åŠ©
   - `*validate-story-draft`: éªŒè¯æ•…äº‹
   - `*backlog-summary`: å¿«é€Ÿå¾…åŠçŠ¶æ€
```

## å‘½ä»¤å¯è§æ€§ç³»ç»Ÿ

### å‘½ä»¤å…ƒæ•°æ®

æ¯ä¸ªå‘½ä»¤ç°åœ¨æœ‰ä¸€ä¸ª `visibility` å±æ€§ï¼Œæ§åˆ¶ä½•æ—¶æ˜¾ç¤º:

```yaml
commands:
  - name: help
    visibility: [full, quick, key]  # å§‹ç»ˆå¯è§
    description: "æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤"

  - name: develop
    visibility: [full, quick, key]  # ä¸»è¦å‘½ä»¤
    description: "å®ç°æ•…äº‹ä»»åŠ¡"

  - name: review-code
    visibility: [full, quick]  # ç»å¸¸ä½¿ç”¨ï¼Œä½†éå…³é”®
    description: "å®¡æŸ¥ä»£ç æ›´æ”¹"

  - name: build
    visibility: [full]  # ä¸å¸¸ç”¨ï¼Œä»…åœ¨æ–°ä¼šè¯ä¸­
    description: "ä¸ºç”Ÿäº§æ„å»º"

  - name: qa-gate
    visibility: [key]  # åœ¨å·¥ä½œæµä¸­å…³é”®ï¼Œä½†ä¸æ€»æ˜¯éœ€è¦
    description: "è¿è¡Œè´¨é‡é—¨ç¦"
```

### åˆ†ç±»æŒ‡å—

**`full` (12 ä¸ªå‘½ä»¤)** - æ–°ä¼šè¯
- æ‰€æœ‰å¯ç”¨å‘½ä»¤
- å±•ç¤ºä»£ç†çš„å®Œæ•´èƒ½åŠ›
- é€‚åˆå‘ç°

**`quick` (6-8 ä¸ªå‘½ä»¤)** - ç°æœ‰ä¼šè¯
- ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤
- ä¸“æ³¨äºç”Ÿäº§åŠ›
- ç§»é™¤ä¸å¸¸ç”¨çš„å‘½ä»¤

**`key` (3-5 ä¸ªå‘½ä»¤)** - å·¥ä½œæµä¼šè¯
- å½“å‰å·¥ä½œæµçš„å…³é”®å‘½ä»¤
- æœ€å°å¹²æ‰°
- æœ€å¤§æ•ˆç‡

## å·¥ä½œæµå¯¼èˆª

### å®šä¹‰çš„å·¥ä½œæµ

**10 ä¸ªå¸¸è§å·¥ä½œæµ:**

1. **story_development** - éªŒè¯ â†’ å¼€å‘ â†’ QA â†’ éƒ¨ç½²
2. **epic_creation** - åˆ›å»ºå²è¯— â†’ åˆ›å»ºæ•…äº‹ â†’ éªŒè¯
3. **backlog_management** - å®¡æŸ¥ â†’ ä¼˜å…ˆçº§ â†’ å®‰æ’
4. **architecture_review** - åˆ†æ â†’ æ–‡æ¡£ â†’ å®¡æŸ¥
5. **git_workflow** - è´¨é‡é—¨ç¦ â†’ PR â†’ åˆå¹¶
6. **database_workflow** - è®¾è®¡ â†’ è¿ç§» â†’ æµ‹è¯•
7. **code_quality_workflow** - è¯„ä¼° â†’ é‡æ„ â†’ æµ‹è¯•
8. **documentation_workflow** - ç ”ç©¶ â†’ æ–‡æ¡£ â†’ åŒæ­¥
9. **ux_workflow** - è®¾è®¡ â†’ å®ç° â†’ éªŒè¯
10. **research_workflow** - å¤´è„‘é£æš´ â†’ åˆ†æ â†’ æ–‡æ¡£

### çŠ¶æ€è½¬æ¢

æ¯ä¸ªå·¥ä½œæµå®šä¹‰çŠ¶æ€ä¹‹é—´çš„è½¬æ¢:
- **Trigger:** æˆåŠŸå®Œæˆçš„å‘½ä»¤
- **Greeting Message:** ä¸Šä¸‹æ–‡æ¶ˆæ¯
- **Next Steps:** å¸¦é¢„å¡«å……å‚æ•°çš„ä¸‹ä¸€ä¸ªå‘½ä»¤å»ºè®®

**ç¤ºä¾‹ (Story Development):**

```yaml
story_development:
  transitions:
    validated:
      trigger: "validate-story-draft æˆåŠŸå®Œæˆ"
      greeting_message: "æ•…äº‹å·²éªŒè¯! å‡†å¤‡å®ç°ã€‚"
      next_steps:
        - command: develop-yolo
          args_template: "${story_path}"
          description: "è‡ªä¸» YOLO æ¨¡å¼ (æ— ä¸­æ–­)"
        - command: develop-interactive
          args_template: "${story_path}"
          description: "äº¤äº’æ¨¡å¼å¸¦æ£€æŸ¥ç‚¹ (é»˜è®¤)"
        - command: develop-preflight
          args_template: "${story_path}"
          description: "å…ˆå…¨éƒ¨è®¡åˆ’ï¼Œç„¶åæ‰§è¡Œ"
```

## å¦‚ä½•æµ‹è¯•

### é€‰é¡¹ 1: è‡ªåŠ¨æµ‹è¯•è„šæœ¬

```bash
node .aios-core/development/scripts/test-greeting-system.js
```

æ­¤è„šæœ¬æµ‹è¯• 4 ç§åœºæ™¯:
1. æ–°ä¼šè¯é—®å€™ (Dev)
2. ç°æœ‰ä¼šè¯é—®å€™ (Dev)
3. å·¥ä½œæµä¼šè¯é—®å€™ (PO)
4. ç®€å•é—®å€™å›é€€

### é€‰é¡¹ 2: Node REPL æ‰‹åŠ¨æµ‹è¯•

```javascript
const GreetingBuilder = require('./.aios-core/development/scripts/greeting-builder');
const builder = new GreetingBuilder();

// æ¨¡æ‹Ÿä»£ç†
const mockAgent = {
  name: 'Dex',
  icon: 'ğŸ’»',
  persona_profile: {
    greeting_levels: {
      named: 'ğŸ’» Dex (Builder) å‡†å¤‡å°±ç»ª!'
    }
  },
  persona: { role: 'å¼€å‘è€…' },
  commands: [
    { name: 'help', visibility: ['full', 'quick', 'key'] }
  ]
};

// æµ‹è¯•æ–°ä¼šè¯
builder.buildGreeting(mockAgent, { conversationHistory: [] })
  .then(greeting => console.log(greeting));
```

### é€‰é¡¹ 3: ç­‰å¾…å®Œæ•´é›†æˆ

å½“ä¸æ¿€æ´»æµç¨‹çš„é›†æˆå®ç°å (Story 6.1.4/6.1.6)ï¼Œç³»ç»Ÿå°†åœ¨æ¿€æ´»ä»»ä½•ä»£ç†æ—¶è‡ªåŠ¨å·¥ä½œ:

```
@dev              â†’ è‡ªåŠ¨ä¸Šä¸‹æ–‡é—®å€™
@po               â†’ è‡ªåŠ¨ä¸Šä¸‹æ–‡é—®å€™
@qa               â†’ è‡ªåŠ¨ä¸Šä¸‹æ–‡é—®å€™
```

## ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒè„šæœ¬
- `.aios-core/core/session/context-detector.js` - ä¼šè¯ç±»å‹æ£€æµ‹
- `.aios-core/infrastructure/scripts/git-config-detector.js` - Git é…ç½®æ£€æµ‹
- `.aios-core/development/scripts/greeting-builder.js` - é—®å€™æ„å»º
- `.aios-core/development/scripts/workflow-navigator.js` - å·¥ä½œæµå¯¼èˆª
- `.aios-core/development/scripts/agent-exit-hooks.js` - é€€å‡ºé’©å­ (ç”¨äºæŒä¹…åŒ–)

### æ•°æ®æ–‡ä»¶
- `.aios-core/data/workflow-patterns.yaml` - å·¥ä½œæµå®šä¹‰

### æµ‹è¯•
- `tests/unit/context-detector.test.js` - 23 ä¸ªæµ‹è¯•
- `tests/unit/git-config-detector.test.js` - 19 ä¸ªæµ‹è¯•
- `tests/unit/greeting-builder.test.js` - 23 ä¸ªæµ‹è¯•
- `tests/integration/performance.test.js` - æ€§èƒ½éªŒè¯

### é…ç½®
- `.aios-core/core-config.yaml` - å…¨å±€é…ç½® (git + agentIdentity éƒ¨åˆ†)

### ä»£ç† (å·²æ›´æ–°)
- `.aios-core/agents/dev.md` - âœ… å‘½ä»¤å¯è§æ€§å…ƒæ•°æ®
- `.aios-core/agents/po.md` - âœ… å‘½ä»¤å¯è§æ€§å…ƒæ•°æ®
- `.aios-core/agents/*.md` - â³ å‰©ä½™ 9 ä¸ªä»£ç† (å¾…æ›´æ–°)

## ä¸‹ä¸€æ­¥

### ç«‹å³ (ä¿®å¤æµ‹è¯•é—®é¢˜)
1. ä¿®å¤æµ‹è¯•é…ç½®é—®é¢˜ (1-2 å°æ—¶)
2. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
3. æ‰§è¡Œæ€§èƒ½æµ‹è¯•

### çŸ­æœŸ (Story 6.1.4 æˆ– 6.1.6)
1. å®ç°ä¸ä»£ç†æ¿€æ´»æµç¨‹çš„é›†æˆ
2. æ›´æ–°å‰©ä½™ 9 ä¸ªä»£ç†çš„å‘½ä»¤å¯è§æ€§å…ƒæ•°æ®
3. ä½¿ç”¨çœŸå®ä»£ç†æ¿€æ´»è¿›è¡Œæµ‹è¯•

### é•¿æœŸ (Story 6.1.2.6)
1. å®ç°åŠ¨æ€å·¥ä½œæµæ¨¡å¼å­¦ä¹ 
2. æ·»åŠ åŸºäºä½¿ç”¨çš„å‘½ä»¤ä¼˜å…ˆçº§
3. å®ç°ä»£ç†åä½œæç¤º

## æ€§èƒ½æŒ‡æ ‡

**ç›®æ ‡ (æ¥è‡ª Story 6.1.2.5):**
- P50 å»¶è¿Ÿ: <100ms
- P95 å»¶è¿Ÿ: <130ms
- P99 å»¶è¿Ÿ: <150ms (ç¡¬é™åˆ¶)

**é¢„æœŸ (åŸºäºä»£ç å®¡æŸ¥):**
- Git é…ç½® (ç¼“å­˜å‘½ä¸­): <5ms âœ…
- Git é…ç½® (ç¼“å­˜æœªå‘½ä¸­): <50ms âœ…
- ä¸Šä¸‹æ–‡æ£€æµ‹: <50ms âœ…
- ä¼šè¯æ–‡ä»¶ I/O: <10ms âœ…
- å·¥ä½œæµåŒ¹é…: <20ms âœ…
- **æ€»è®¡ P99:** ~100-120ms âœ… (è¿œä½äºé™åˆ¶)

**ä¼˜åŒ–:**
- å¹¶è¡Œæ‰§è¡Œ (Promise.all)
- åŸºäº TTL çš„ç¼“å­˜
- è¶…æ—¶ä¿æŠ¤
- ç¼“å­˜å‘½ä¸­æ—¶æå‰é€€å‡º

## å‘åå…¼å®¹æ€§

**100% å‘åå…¼å®¹:**
- æ²¡æœ‰å¯è§æ€§å…ƒæ•°æ®çš„ä»£ç†æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤ (æœ€å¤š 12)
- ä»»ä½•é”™è¯¯æ—¶ä¼˜é›…å›é€€åˆ°ç®€å•é—®å€™
- æ¿€æ´»æµç¨‹é›¶ç ´åæ€§æ›´æ”¹
- æ¸è¿›å¼è¿ç§» (ç¬¬ 1 é˜¶æ®µ: dev/po â†’ ç¬¬ 2 é˜¶æ®µ: å‰©ä½™ 9 ä¸ª)

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆæˆ‘æ¿€æ´»ä»£ç†æ—¶é—®å€™ä¸æ˜¯ä¸Šä¸‹æ–‡çš„?**
A: ä¸æ¿€æ´»æµç¨‹çš„é›†æˆå°šæœªå®ç°ã€‚ç»„ä»¶å­˜åœ¨ä½†å°šæœªè‡ªåŠ¨è°ƒç”¨ã€‚

**Q: é›†æˆä½•æ—¶å®Œæˆ?**
A: åœ¨æœªæ¥çš„æ•…äº‹ä¸­ (å¯èƒ½æ˜¯ 6.1.4 æˆ– 6.1.6)ã€‚å–å†³äºä»£ç†é…ç½®ç³»ç»Ÿã€‚

**Q: å¦‚ä½•ç°åœ¨æµ‹è¯•?**
A: ä½¿ç”¨æµ‹è¯•è„šæœ¬: `node .aios-core/development/scripts/test-greeting-system.js`

**Q: å¦‚æœä»£ç†æ²¡æœ‰å¯è§æ€§å…ƒæ•°æ®ä¼šå‘ç”Ÿä»€ä¹ˆ?**
A: å›é€€: æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤ (æœ€å¤š 12)ã€‚ä¸ä¼šç ´åä»»ä½•ä¸œè¥¿ã€‚

**Q: å¦‚ä½•ç»™æˆ‘çš„å‘½ä»¤æ·»åŠ å¯è§æ€§å…ƒæ•°æ®?**
A: å‚è§ä¸Šé¢çš„ "å‘½ä»¤å¯è§æ€§ç³»ç»Ÿ" éƒ¨åˆ†å’Œ dev.md å’Œ po.md ä»£ç†ä¸­çš„ç¤ºä¾‹ã€‚

**Q: æˆ‘å¯ä»¥ç¦ç”¨ä¸Šä¸‹æ–‡é—®å€™å—?**
A: å¯ä»¥ï¼Œé€šè¿‡é…ç½®: `core-config.yaml` â†’ `agentIdentity.greeting.contextDetection: false`

---

**æ–‡æ¡£æ›´æ–°:** 2025-01-15
**ä½œè€…:** Quinn (QA) + Dex (Dev)
**æ•…äº‹:** 6.1.2.5 - ä¸Šä¸‹æ–‡ä»£ç†åŠ è½½ç³»ç»Ÿ
